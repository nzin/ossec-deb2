#!/usr/bin/make -f
# -*- makefile -*-
# Sample debian/rules that uses debhelper.
#
# This file was originally written by Joey Hess and Craig Small.
# As a special exception, when this file is copied by dh-make into a
# dh-make output file, you may use that output file without restriction.
# This special exception was added by Craig Small in version 0.37 of dh-make.
#
# Modified to make a template file for a multi-binary package with separated
# build-arch and build-indep targets  by Bill Allombert 2001

# Uncomment this to turn on verbose mode.
export DH_VERBOSE=1

# This has to be exported to make some magic below work.
export DH_OPTIONS

PKG_BASENAME="ossec-hids"
CURDIR="`pwd`"


configure-stamp:
	dh_testdir


	touch configure-stamp

configure-%: configure-stamp

#	USER_LANGUAGE="en"	# Here we have to choose if autodetect or ask to the user. First choice preferred.
#	USER_NO_STOP="no"
#	USER_UPDATE="" 

#	BUILD="yes"	# variable used to stop the installation script


#configure-local:

#	USER_INSTALL_TYPE="local"

#configure-server:

#	USER_INSTALL_TYPE="server"

#configure-agent:

#	USER_INSTALL_TYPE="agent"


build-local: build-local-stamp #configure-local
build-local-stamp:
	dh_testdir
	USER_INSTALL_TYPE="local" BUILD="yes" USER_LANGUAGE="en" USER_NO_STOP="no" USER_DIR="/var/ossec" USER_ENABLE_EMAIL="n" EMAIL_NOTIFY="n" USER_ENABLE_ACTIVE_RESPONSE="n" USER_ENABLE_SYSCHECK="n" USER_ENABLE_ROOTCHECK="n" ./install.sh debug
	touch build-local-stamp

build-server: build-server-stamp #configure-server
build-server-stamp:
	dh_testdir
# Possible values for:
# - USER_LANGUAGE: any value in $(ls ./etc/templates/)
# - USER_DIR == DESTDIR <-- values assigned now have to change in the near future.
# - USER_DELETE_DIR: set this variable to "y" if you want to delete the $USER_DIR directory without being asked by the system.
# - 
	USER_INSTALL_TYPE="server" BUILD="yes" USER_LANGUAGE="en" USER_NO_STOP="no" ACTIVE_RESPONSE="n" USER_DIR="/var/ossec" USER_DELETE_DIR="" USER_ENABLE_EMAIL="n" EMAIL_NOTIFY="n" USER_ENABLE_ACTIVE_RESPONSE="n" USER_ENABLE_SYSLOG="n" USER_ENABLE_SYSCHECK="n" USER_ENABLE_ROOTCHECK="n" ./install.sh debug
	touch build-server-stamp

build-agent: build-agent-stamp #configure-agent
build-agent-stamp:
	dh_testdir
# - USER_AGENT_SERVER_IP : needed to configure the client. Could we use a domain name?
#			!! IT WAS SET TO "127.0.0.1" for testing purposes.
# 
	USER_INSTALL_TYPE="agent" BUILD="yes" USER_LANGUAGE="en" USER_NO_STOP="n" ACTIVE_RESPONSE="n" USER_DIR="/var/ossec" USER_DELETE_DIR="" USER_AGENT_SERVER_IP="127.0.0.1" USER_ENABLE_ACTIVE_RESPONSE="n" ./install.sh debug
	touch build-agent-stamp

build: build-stamp 
build-stamp: build-local build-server build-agent
	touch build-stamp

install: install-doc install-server install-agent install-local


install-%:
	dh_testdir
	dh_testroot
	dh_prep
	dh_installdirs

	USER_LANGUAGE="en"
	USER_NO_STOP="no"
#	USER_UPDATE = 
	BUILD="no"

	BASE_DESTDIR="$(CURDIR)/debian"

install-doc:

	PKG="$(PKG_BASENAME)-doc"
	DESTDIR = "$(BASE_DESTDIR)/$(PKG)"

# This target needs to be done
	dh_install

install-local:

	PKG="$(PKG_BASENAME)-local"
	DESTDIR = "$(BASE_DESTDIR)/$(PKG)"

	USER_INSTALL_TYPE="$(USER_INSTALL_TYPE)" BUILD="$(BUILD)" USER_LANGUAGE="$(USER_LANGUAGE)" USER_NO_STOP="n" USER_DIR="$(DESTDIR)" ./install.sh debug

	dh_install


install-server:

	PKG="$(PKG_BASENAME)-server"
	DESTDIR = "$(BASE_DESTDIR)/$(PKG)"

	USER_INSTALL_TYPE="$(USER_INSTALL_TYPE)" BUILD="$(BUILD)" USER_LANGUAGE="$(USER_LANGUAGE)" USER_NO_STOP="n" ./install.sh

	dh_install

install-client:

	PKG="$(PKG_BASENAME)-client"
	DESTDIR = "$(BASE_DESTDIR)/$(PKG)"

	USER_INSTALL_TYPE="$(USER_INSTALL_TYPE)" BUILD="$(BUILD)" USER_LANGUAGE="$(USER_LANGUAGE)" USER_NO_STOP="n" ./install.sh
	dh_install

binary:

binary-arch:

binary-indep:

get-orig-source:


clean: 
	dh_testdir
	dh_testroot
	dh_clean
	cd src && make clean
# Clean up additional auto-generated files
	for file in etc/ossec.mc src/Config.OS \
		src/analysisd/compiled_rules/compiled_rules.h \
		src/analysisd/ossec-logtest src/analysisd/ossec-makelists \
		src/isbigendian src/isbigendian.c ; do \
		[ -e $$file ] && rm -f $$file; \
	done


#%:
#	dh $@ 
